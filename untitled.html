<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>Untitled</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
  </head>
  <body bgcolor="#000000" text="#cfcfcf" link="#00ff66" vlink="#00b7ff" alink="#ff3355">
    <pre id="p">
loading...
    </pre>

    <div id="junk"></div>

    <p id="nav">
      <a href="#/calm">calm</a>
      <a href="#/noise">noise</a>
      <a href="#/void">void</a>
      <a href="#/panic">panic</a>
      <a href="#/invert">invert</a>
      <a href="#/acid">acid</a>
      <a href="#/maze">maze</a>
      <a href="#/flood">flood</a>
      <a href="#/mirror">mirror</a>
      <a href="#/404">404</a>
      <a href="#/help">help</a>
    </p>

    <script type="text/javascript">
      (function () {
        var pre = document.getElementById("p");
        var junk = document.getElementById("junk");
        var nav = document.getElementById("nav");
        var typed = "";
        var mode = "calm";
        var w = 80;
        var h = 24;
        var tick = 0;

        function clamp(n, a, b) {
          return Math.max(a, Math.min(b, n));
        }

        function shuffleArray(a) {
          for (var i = a.length - 1; i > 0; i--) {
            var j = (Math.random() * (i + 1)) | 0;
            var t = a[i];
            a[i] = a[j];
            a[j] = t;
          }
          return a;
        }

        function pick(s) {
          return s.charAt((Math.random() * s.length) | 0);
        }

        function esc(s) {
          return (s || "")
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;");
        }

        function hex2() {
          var n = (Math.random() * 256) | 0;
          return (n < 16 ? "0" : "") + n.toString(16);
        }

        function randHex() {
          return "#" + hex2() + hex2() + hex2();
        }

        function palette(violent) {
          if (!violent) {
            document.body.bgColor = "#000000";
            document.body.text = "#cfcfcf";
            document.body.link = "#00ff66";
            document.body.vLink = "#00b7ff";
            document.body.aLink = "#ff3355";
            return;
          }
          document.body.bgColor = randHex();
          document.body.text = randHex();
          document.body.link = randHex();
          document.body.vLink = randHex();
          document.body.aLink = randHex();
        }

        function setMode(m) {
          mode = m || "calm";
          if (mode === "invert") {
            document.body.bgColor = "#ffffff";
            document.body.text = "#000000";
            document.body.link = "#0000ff";
            document.body.vLink = "#551a8b";
            document.body.aLink = "#ff0000";
          } else if (mode === "acid") {
            palette(true);
          } else {
            palette(false);
          }

          if (mode === "mirror") document.body.dir = "rtl";
          else if (Math.random() < 0.15 && (mode === "panic" || mode === "acid")) document.body.dir = "rtl";
          else document.body.dir = "ltr";

          stamp("mode");
        }

        function applyHash() {
          var hash = (location.hash || "").toLowerCase();
          var m = hash.match(/^#\/([a-z]+)$/);
          if (!m) return;
          if (m[1] === "help") {
            pre.innerHTML =
              "click = disturb\n" +
              "space = shuffle\n" +
              "esc = clear\n" +
              "type = inject\n" +
              "tab = scramble links\n" +
              "\n" +
              "#/calm #/noise #/void #/panic #/invert\n" +
              "#/acid #/maze #/flood #/mirror #/404\n" +
              "\n"+
              "lirz.ru"; 
            return;
          }
          setMode(m[1]);
        }

        function size() {
          w = clamp(((window.innerWidth / 9) | 0) - 2, 40, 140);
          h = clamp(((window.innerHeight / 18) | 0) - 6, 14, 60);
        }

        function line(len, charset) {
          var s = "";
          for (var i = 0; i < len; i++) s += pick(charset);
          return s;
        }

        function banner() {
          var b = "";
          var t = typed ? typed.toUpperCase() : "UNTITLED";
          if (t.length > 16) t = t.substring(0, 16);
          b += " " + t + " ";
          while (b.length < w) b += pick(" .:-=+*#@");
          return b.substring(0, w);
        }

        function mutateHtml(s) {
          if (mode === "calm" || mode === "void") return s;

          var colors = ["#00ff66", "#00b7ff", "#ff3355", "#ffff00", "#ffffff", "#cfcfcf"];
          if (mode === "acid") colors = [randHex(), randHex(), randHex(), randHex()];

          var out = s;
          if (Math.random() < 0.55) {
            out = out.replace(/[A-Z0-9?]/g, function (ch) {
              if (Math.random() < 0.04) return "<blink>" + ch + "</blink>";
              if (Math.random() < 0.12) return '<font color="' + pick(colors) + '">' + ch + "</font>";
              if (Math.random() < 0.03) return '<a href="#/' + pick("cngvpia") + '">?</a>';
              return ch;
            });
          }
          if (mode === "panic" || mode === "acid") {
            if (Math.random() < 0.25) out = out.split("\n").reverse().join("\n");
            if (Math.random() < 0.25) out = out.split("").reverse().join("");
          }
          return out;
        }

        function maze() {
          var charset = "+-|/\\\\";
          var out = "";
          for (var y = 0; y < h; y++) {
            var row = "";
            for (var x = 0; x < w; x++) {
              if (x === 0 || x === w - 1 || y === 0 || y === h - 1) row += "#";
              else if (Math.random() < 0.12) row += "#";
              else if (Math.random() < 0.07) row += pick(charset);
              else row += " ";
            }
            if (typed && Math.random() < 0.25) {
              var t = typed.toUpperCase().substring(0, clamp(typed.length, 1, 16));
              var pos = (Math.random() * Math.max(1, w - t.length - 2) + 1) | 0;
              row = row.substring(0, pos) + t + row.substring(pos + t.length);
            }
            out += row + "\n";
          }
          return out;
        }

        function flood() {
          var out = "";
          var t = typed ? typed.toUpperCase() : "FLOOD";
          var stream = (t + " ").repeat(999);
          for (var y = 0; y < h; y++) {
            var off = ((tick * 7 + y * 13) % 40) | 0;
            out += stream.substring(off, off + w) + "\n";
          }
          return out;
        }

        function fake404() {
          var lines = [];
          lines.push("404 NOT FOUND");
          lines.push("");
          lines.push("GET /" + line(8, "abcdefghijklmnopqrstuvwxyz") + "  ->  200??");
          lines.push("GET /" + line(8, "abcdefghijklmnopqrstuvwxyz") + "  ->  301??");
          lines.push("GET /" + line(8, "abcdefghijklmnopqrstuvwxyz") + "  ->  404!!");
          lines.push("");
          lines.push("index.of.this.page:");
          for (var i = 0; i < 12; i++) {
            var name = line(((Math.random() * 8) | 0) + 3, "abcdefghijklmnopqrstuvwxyz");
            var ext = pick([".html", ".gif", ".txt", ".cgi", ".zip", ".tar", ".php", ".wav"]);
            var size = ((Math.random() * 9000) | 0) + "b";
            var href = "#/" + pick(["calm", "noise", "void", "panic", "acid", "maze", "flood", "mirror", "invert"]);
            lines.push('<a href="' + href + '">' + name + ext + "</a>" + "   " + size);
          }
          lines.push("");
          lines.push("last-modified: " + new Date().toUTCString());
          return lines.join("\n");
        }

        function renderJunk(reason) {
          if (mode === "calm" || mode === "void") {
            junk.innerHTML = "";
            return;
          }
          if (reason === "mode" || Math.random() < 0.25 || mode === "panic" || mode === "acid") {
            var cols = clamp(((Math.random() * 10) | 0) + 3, 3, 12);
            var rows = clamp(((Math.random() * 6) | 0) + 2, 2, 8);
            var html = "";

            if (mode === "panic" || mode === "acid") {
              var msg = typed ? esc(typed.toUpperCase()) : "RUN";
              html +=
                '<marquee behavior="alternate" scrollamount="' +
                (((Math.random() * 18) | 0) + 2) +
                '"><font size="' +
                (((Math.random() * 6) | 0) + 1) +
                '" color="' +
                randHex() +
                '">' +
                msg +
                "</font></marquee>";
            }

            html += '<table border="1" cellpadding="0" cellspacing="0">';
            for (var r = 0; r < rows; r++) {
              html += "<tr>";
              for (var c = 0; c < cols; c++) {
                var bg = mode === "acid" ? randHex() : pick(["#000000", "#111111", "#ffffff", "#002200", "#220000"]);
                var fg = mode === "acid" ? randHex() : pick(["#cfcfcf", "#00ff66", "#00b7ff", "#ff3355", "#ffff00"]);
                var label = pick(["///", "???", "NULL", "OK", "NO", "YES", "EXIT", "ENTER", "LIRZ", "ERR"]);
                var href2 = "#/" + pick(["calm", "noise", "void", "panic", "invert", "acid", "maze", "flood", "mirror", "404"]);
                html +=
                  '<td bgcolor="' +
                  bg +
                  '"><font color="' +
                  fg +
                  '" face="Courier New, monospace">' +
                  '<a href="' +
                  href2 +
                  '">' +
                  label +
                  "</a>" +
                  "</font></td>";
              }
              html += "</tr>";
            }
            html += "</table>";

            if (mode === "noise" && Math.random() < 0.35) {
              html += '<p><img src="x" alt="x"> <img src="y" alt="y"> <img src="z" alt="z"></p>';
            }

            junk.innerHTML = html;
          }
        }

        function scrambleNav() {
          var links = nav.getElementsByTagName("a");
          var arr = [];
          for (var i = 0; i < links.length; i++) arr.push(links[i].outerHTML);
          shuffleArray(arr);
          nav.innerHTML = arr.join(" \n");
        }

        function stamp(reason) {
          tick++;
          size();

          var A = " .:-=+*#%@";
          var B = "[]{}()<>/\\\\|_~^";
          var C = "01";
          var D = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
          var E = "█▓▒░";
          var charset =
            A +
            B +
            (mode === "noise" || mode === "panic" || mode === "acid" ? C : "") +
            (mode === "panic" || mode === "acid" ? D : "") +
            (mode === "acid" ? E : "");

          var out = "";
          if (mode === "maze") out += " " + (typed ? typed.toUpperCase().substring(0, 16) : "MAZE") + "\n";
          else if (mode === "404") out += " " + "NOT FOUND" + "\n";
          else out += banner() + "\n";

          out += line(w, mode === "void" ? " " : charset) + "\n";

          if (mode === "maze") {
            out += maze();
          } else if (mode === "flood") {
            out += flood();
          } else if (mode === "404") {
            out += fake404() + "\n";
          } else {
            for (var y = 0; y < h; y++) {
              if (mode === "void" && Math.random() < 0.7) {
                out += line(w, " ") + "\n";
                continue;
              }
              var row = line(w + ((mode === "panic" || mode === "acid") && Math.random() < 0.3 ? ((Math.random() * 30) | 0) - 15 : 0), charset);
              if (row.length < w) row += line(w - row.length, charset);
              if (row.length > w) row = row.substring(0, w);

              if (typed && Math.random() < (mode === "panic" || mode === "acid" ? 0.65 : 0.35)) {
                var t2 = typed.toUpperCase().substring(0, 22);
                var pos = (Math.random() * Math.max(1, w - t2.length - 1)) | 0;
                row = row.substring(0, pos) + t2 + row.substring(pos + t2.length);
              }

              if (mode === "panic" || mode === "acid") {
                if (Math.random() < 0.18) row = row.split("").reverse().join("");
                if (Math.random() < 0.18) row = row.substring(1) + pick(charset);
                if (Math.random() < 0.12) row = row.substring(0, (Math.random() * w) | 0);
                if (row.length < w) row += line(w - row.length, charset);
              }
              out += row + "\n";
            }
          }

          if (mode === "panic" || mode === "acid") out += "\n" + line(w, "!!!??!?/\\\\<>[]{}") + "\n";
          out += "\n" + "mode: " + mode + "    " + "typed: " + (typed || "_") + "    " + "t: " + tick + "\n";

          if (mode === "acid") {
            palette(true);
            document.title = line(6, "lirzLIRZ01") + " " + line(10, "!?/\\\\[]{}<>") + " " + tick;
          } else if (mode === "panic") {
            document.title = "!!! " + (typed ? typed.toUpperCase().substring(0, 12) : "PANIC") + " " + tick;
          } else if (mode === "404") {
            document.title = "404 " + line(6, "abcdef0123456789");
          } else {
            document.title = "lirz.ru";
          }

          if (mode === "panic" && Math.random() < 0.04) scrambleNav();
          if ((mode === "panic" || mode === "acid") && Math.random() < 0.03) {
            var jump = pick(["calm", "noise", "void", "panic", "invert", "acid", "maze", "flood", "mirror", "404"]);
            location.hash = "#/" + jump;
          }

          pre.innerHTML = mutateHtml(out);
          renderJunk(reason);
        }

        function disturb() {
          stamp("click");
          if (mode === "panic" || mode === "acid") stamp("click2");
        }

        window.onresize = function () {
          stamp("resize");
        };
        window.onhashchange = applyHash;
        document.onclick = disturb;

        document.onkeydown = function (e) {
          e = e || window.event;
          var k = e.key || "";

          if (k === "Escape") {
            typed = "";
            palette(false);
            document.body.dir = "ltr";
            stamp("esc");
            return;
          }

          if (k === " ") {
            if (e.preventDefault) e.preventDefault();
            stamp("space");
            return;
          }

          if (k === "Tab") {
            if (e.preventDefault) e.preventDefault();
            scrambleNav();
            stamp("tab");
            return;
          }

          if (k === "Backspace") {
            typed = typed.substring(0, Math.max(0, typed.length - 1));
            stamp("bs");
            return;
          }

          if (k.length === 1 && !e.ctrlKey && !e.altKey && !e.metaKey) {
            typed = (typed + k).substring(Math.max(0, (typed + k).length - 18));
            if (tick % 2 === 0) stamp("type");
          }
        };

        function loop() {
          if (mode === "noise") stamp("loop");
          if (mode === "panic") stamp("loop");
          if (mode === "acid") stamp("loop");
          if (mode === "flood") stamp("loop");
          if (mode === "mirror" && Math.random() < 0.5) stamp("loop");
          setTimeout(
            loop,
            mode === "panic"
              ? 70
              : mode === "acid"
                ? 55
                : mode === "noise"
                  ? 190
                  : mode === "flood"
                    ? 140
                    : mode === "maze"
                      ? 420
                      : mode === "404"
                        ? 650
                        : 950
          );
        }

        setMode("calm");
        applyHash();
        stamp("init");
        loop();
      })();
    </script>
  </body>
</html>
